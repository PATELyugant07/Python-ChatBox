    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ChatMCA</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
        <style>
            .main-container {
                max-width: 1200px;
                height: 90vh;
            }
            .sidebar {
                width: 300px;
                background-color: #F3F4F6;
            }
            .chat-area {
                flex-grow: 1;
                height: 100%;
            }
            .chat-messages {
                height: calc(100% - 100px);
                overflow-y: auto;
            }
            .message-bubble {
                border-radius: 1.25rem;
                padding: 0.75rem 1rem;
            }
            .user-message {
                background-color: #2563EB;
                color: white;
                margin-left: auto;
            }
            .bot-message {
                background-color: #E5E7EB;
                color: #374151;
            }
        </style>
    </head>
    <body class="bg-gray-100 flex items-center justify-center h-screen">
        <div class="main-container bg-white shadow-xl rounded-2xl flex">
            <div class="sidebar p-6 flex flex-col rounded-l-2xl">
                <h2 class="text-xl font-bold mb-4 text-gray-800">Chat Summary</h2>
                <div id="summary-display" class="text-gray-600 text-sm overflow-y-auto">
                    <p>Start a conversation to see a summary here...</p>
                </div>
                <button id="clear-chat-btn" class="mt-auto bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition">Clear Chat</button>
            </div>

            <div class="chat-area flex flex-col p-6 rounded-r-2xl">
                <h1 class="text-3xl font-bold text-center mb-4 text-gray-800">ChatMCA</h1>
                <div id="chat-messages" class="chat-messages flex flex-col space-y-4 p-4">
                    </div>
                <form id="chat-form" class="flex p-4 border-t-2 border-gray-200">
                    <textarea
                        id="user-input"
                        class="flex-1 resize-none border-0 rounded-full px-4 py-2 bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Type your message..."
                        rows="1"
                    ></textarea>
                    <button
                        type="submit"
                        class="ml-2 bg-blue-600 text-white rounded-full p-3 hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" transform="rotate(90 12 12)"/>
                        </svg>
                    </button>
                </form>
            </div>
        </div>

        <script>
            // JavaScript for handling the chat logic
            const chatForm = document.getElementById('chat-form');
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const summaryDisplay = document.getElementById('summary-display');
            const clearChatBtn = document.getElementById('clear-chat-btn');

            let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

            // --- Core Functions ---
            function addMessage(text, sender) {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('flex', 'space-x-2', 'items-start', 'max-w-xs');

                const messageBubble = document.createElement('p');
                messageBubble.classList.add('message-bubble', 'text-sm');
                messageBubble.textContent = text;

                if (sender === 'user') {
                    messageContainer.classList.add('justify-end');
                    messageBubble.classList.add('user-message');
                } else {
                    messageContainer.classList.add('justify-start');
                    messageBubble.classList.add('bot-message');
                }
                
                messageContainer.appendChild(messageBubble);
                chatMessages.appendChild(messageContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to the bottom
            }

            // Function to save history and trigger summary
            async function updateChatState(userMessage, botResponse) {
                chatHistory.push({ sender: 'user', text: userMessage });
                chatHistory.push({ sender: 'bot', text: botResponse });
                
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));

                // Request a new summary from the server
                try {
                    const response = await fetch('/api/summarize/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ history: chatHistory }),
                    });
                    const data = await response.json();
                    if (response.ok) {
                        summaryDisplay.textContent = data.summary;
                        localStorage.setItem('chatSummary', data.summary); // Save the new summary
                    } else {
                        summaryDisplay.textContent = 'Could not generate summary.';
                    }
                } catch (error) {
                    summaryDisplay.textContent = 'Failed to connect to summarization service.';
                }
            }
            
            // --- Event Listeners and Initial Load ---
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const message = userInput.value.trim();
                if (!message) return;

                addMessage(message, 'user');
                userInput.value = '';

                addMessage('...', 'bot'); // Loading indicator

                try {
                    const response = await fetch('/api/chat/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: message }),
                    });

                    const data = await response.json();
                    chatMessages.removeChild(chatMessages.lastChild); // Remove loading indicator

                    if (response.ok) {
                        addMessage(data.response, 'bot');
                        updateChatState(message, data.response); // Update chat state after a successful response
                    } else {
                        addMessage(`Error: ${data.error}`, 'bot');
                    }
                } catch (error) {
                    chatMessages.removeChild(chatMessages.lastChild);
                    addMessage('An unexpected error occurred. Please try again.', 'bot');
                }
            });
            
            clearChatBtn.addEventListener('click', () => {
                localStorage.clear();
                chatHistory = [];
                chatMessages.innerHTML = '';
                summaryDisplay.textContent = 'Start a conversation to see a summary here...';
            });

            // Load chat history and summary on page load
            document.addEventListener('DOMContentLoaded', () => {
                if (chatHistory.length > 0) {
                    chatHistory.forEach(msg => addMessage(msg.text, msg.sender));
                    const storedSummary = localStorage.getItem('chatSummary');
                    if (storedSummary) {
                        summaryDisplay.textContent = storedSummary;
                    } else {
                        summaryDisplay.textContent = 'Loading summary...';
                    }
                }
            });
        </script>
    </body>
    </html>